---
title: "DCX_analyses"
authors: Corentin Bernou, Alexandra Chicheportiche, LÃ©a Bellenger
output:
  html_document:
    df_print: paged
    
---
In this script, we generate genelists of both iNB DcxHigh and iNB DcxLow cells from a Seurat object.
```{r}
library(tidyverse)
library(dplyr)
library(Seurat)

```
---
Import objects

```{r}

SCT_obj <- readRDS("Objects/SCT_obj.rds")
Biomart_annotated <- read.csv("Analysis_tools/Biomart_annotated.csv")
```

This analysis is focused on NPC populations, therefore we will use a subset of the base object
```{r}
Idents(SCT_obj) <- "clusters"
clusters_of_NPC <- c("4", "13", "17","20","12", "15", "19","5",
                                  "8", "10","1", "3", "7","9")

NPC_obj <- subset(SCT_obj, clusters %in% clusters_of_NPC) 
rm(SCT_obj)
```

Adding dcx_lvl status metadata on samples
```{r}
dcx_expression <- FetchData( 
   NPC_obj,
    vars = c("ENSMUSG00000031285", "ident", "Status"),
    assay = "SCT",
    slot = "counts"
  ) %>%
    mutate(dcx = ifelse(ENSMUSG00000031285 > 1,"DcxHigh","DcxLow"))

dcx_expression$dcx <- factor(dcx_expression$dcx, levels = c("DcxHigh","DcxLow"))
  
dcx_vals <- dcx_expression$dcx
names(dcx_vals) <- rownames(dcx_expression)
table(dcx_vals)

NPC_obj <- AddMetaData(SCT_obj_NPC, metadata = dcx_vals, col.name = "dcx_lvl")
```

Histogram representation of the DCX gene expression level in the SCT assay of the NPC_obj Seurat

```{r} 
hist(NPC_obj@assays[["SCT"]]@data["ENSMUSG00000031285",])

```

```{r} 
clusters_of_iNB <- c("12", "15", "19","5","8", "10")

iNB_sub <- subset(NPC_obj, clusters %in% clusters_of_iNB)

Markers_object_Dcx <- PrepSCTFindMarkers(iNB_sub)
Idents(NPC_obj) <- "dcx_lvl"


Markers_iNB_dcx <- FindAllMarkers(Markers_object_Dcx,
               assay = "SCT", 
               logfc.threshold = 0.1,
               test.use = "wilcox",
               only.pos = T)
    
inb_sub_markers <- 
  merge(x = Markers_iNB_dcx,
        y = Biomart_annotated[, 1:3],
        by.x = "gene",
        by.y = "ensembl_gene_id",
        all.x = TRUE)

write.csv(x = inb_sub_markers,
          file = "Markers_store/inb_sub_markers_dcx.csv")
for (i in levels(inb_sub_markers$cluster)) {
  export_markers <- filter(inb_sub_markers,
                           cluster == i &
                             pct.2 < 0.4 & pct.1 > 0.4 & p_val_adj < 0.05) %>%
    arrange(desc(avg_log2FC))
  write.table(export_markers,
              file = paste0("Markers_store/iNB_markers_", i, ".csv"))
}
```
Violin plot Dcx expression in the neurogenic related clusters

```{r} 


